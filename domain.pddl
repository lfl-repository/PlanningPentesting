(define (domain pentesting_domain)
  (:requirements :typing :fluents)
  (:types 
    application
    state
    sql_injection
    xss 
  )

  (:predicates
    (state ?s - state)
    (state_connection ?s1 ?s2 - state)
    (obtained_authentication ?aut - application)
    (run_crawler ?aut - application)
    (run_scanner ?aut - application)
    (run_exploitation ?aut - application)
    (has_authentication ?aut - application)
    (sql_injection_testing ?v - sql_injection)
    (xss_testing ?v - xss)	      
  )

  (:functions (priority))

  ;Aut1
  (:action authentication_info_wapiti
    :parameters   (?aut - application)
    :precondition (and (not(run_crawler ?ast))
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
                       (tem_autenticacao ?ast))
   
    :effect       (and (autenticacao_obtida ?ast))	
  ) 

  ;Cr1
  (:action crawler_htcap_sem_autenticacao
    :parameters   (?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (not(crawler_executado ?ast))
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
                       (not(tem_autenticacao ?ast)))
   
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (crawler_executado ?ast))
  ) 

  ;Cr2
  (:action crawler_htcap_com_autenticacao
    :parameters   (?ast - application
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (not(crawler_executado ?ast))
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
                       (tem_autenticacao ?ast)
                       (autenticacao_obtida ?ast))
   
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (crawler_executado ?ast))
  ) 

  ;Varr1
  (:action varredura_skipfish_sem_autenticacao
    :parameters   (?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
                       (not(tem_autenticacao ?ast)))
   
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (varredura_executada ?ast)
                       (increase (prioridade) 3))
  ) 
 
  ;Varr2
  (:action varredura_arachni_sem_autenticacao
    :parameters   (?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
                       (not(tem_autenticacao ?ast)))
			
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (varredura_executada ?ast)
                       (increase (prioridade) 2))
  ) 

  ;Varr3
  (:action varredura_zap_sem_autenticacao
    :parameters   (?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
                       (not(tem_autenticacao ?ast)))
   
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (varredura_executada ?ast)
                       (increase (prioridade) 1))  
  )  

  ;Varr4
  (:action varredura_skipfish_com_autenticacao
    :parameters   (?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
                       (tem_autenticacao ?ast)
                       (autenticacao_obtida ?ast))            
   
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (varredura_executada ?ast)
                       (increase (prioridade) 3))
  ) 

  ;Varr5
  (:action varredura_arachni_com_autenticacao
    :parameters   (?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
   	                   (tem_autenticacao ?ast)
                       (autenticacao_obtida ?ast))            
   
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (varredura_executada ?ast)
                       (increase (prioridade) 2))
  ) 

  ;Varr6
  (:action varredura_zap_com_autenticacao
    :parameters   (?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (not(varredura_executada ?ast))
                       (not(exploracao_executada ?ast))
   	                   (tem_autenticacao ?ast)
                       (autenticacao_obtida ?ast))            
   
    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (varredura_executada ?ast)
                       (increase (prioridade) 1))
  ) 
  
  ;Exp1
  (:action exploracao_sqlmap_sem_autenticacao
    :parameters   (?v - injecao_sql ?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (varredura_executada ?ast)
                       (not(exploracao_executada ?ast))
                       (not(tem_autenticacao ?ast))
                       (teste_injecao_sql ?v))

    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (exploracao_executada ?ast))
  ) 

  ;Exp2
  (:action exploracao_xsser_sem_autenticacao
    :parameters   (?v - xss ?ast - application 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (varredura_executada ?ast)
                       (not(exploracao_executada ?ast))
                       (not(tem_autenticacao ?ast))
                       (teste_xss ?v))

    :effect       (and (estado ?proximo)
                       (not(estado ?atual))
                       (exploracao_executada ?ast))
  ) 

  ;Exp3
  (:action exploracao_sqlmap_com_autenticacao
    :parameters   (?v - injecao_sql ?ast - aplicacao 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (varredura_executada ?ast)
                       (not(exploracao_executada ?ast))
                       (tem_autenticacao ?ast)
                       (autenticacao_obtida ?ast)
                       (teste_injecao_sql ?v))

    :effect       (and (estado ?proximo)
                       (not(estado ?atual))                      
                       (exploracao_executada ?ast))
  ) 

  ;Exp4
  (:action exploracao_xsser_com_autenticacao
    :parameters   (?v - xss ?ast - aplicacao 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (varredura_executada ?ast)
                       (not(exploracao_executada ?ast))
                       (tem_autenticacao ?ast)
                       (autenticacao_obtida ?ast)
                       (teste_xss ?v))

    :effect       (and (estado ?proximo)
                       (not(estado ?atual))                      
                       (exploracao_executada ?ast))
  ) 

  ;Frw1
  (:action exploracao_metasploit_exploit
    :parameters   (?e - exploit ?ast - aplicacao 
                   ?atual - estado ?proximo - estado)
    :precondition (and (estado ?atual)
                       (conexao_estados ?atual ?proximo)
                       (crawler_executado ?ast)
                       (varredura_executada ?ast)
                       (not(exploracao_executada ?ast))
                       (executa_exploit ?e))

    :effect       (and (estado ?proximo)
                       (not(estado ?atual))                      
                       (exploracao_executada ?ast))
  )

)
